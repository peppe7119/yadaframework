<!DOCTYPE html>
<html xmlns:yada="http://www.yadaframework.net" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
</head>
<!--/*
A component to add, view, sort and delete a set of uploaded images.
Parameters:
- images = A list of images, can be empty but never null
- entityIdValue = the id of the entity holding the gallery. 
  				  It will be sent to the controller as a "id" request parameter if entityIdName is not defined.
- entityIdName = (optional) the name of the id request parameter - defaults to "id"
- multipartName = (optional) name of the multipart request parameter that will contain the uploaded image
- size = YadaIntDimension for the minimum size of the image (optional)
- accept = the accept attribute (optional): file_extension, audio/*, image/* etc.
- required = true for a required value (optional)
- urlAdd - url to post the new image form. The uploaded image parameter is called "newImage"
- urlDelete - url to delete an image. It receives the "imageId" parameter.
- urlSort - url to sort an image. It receives the "currentId", "otherId" and "${entityIdName}" parameters. The controller should just 
            call yadaAttachedFileRepository.swapSortOrder(currentId, otherId);
- sorterId - (optional) The id of this sorter, useful when there is more than one on page. Defaults to "yadaImageSorter"
- labelKeyAdd = key in messages.properties for the label of the upload form
- labelAdd = label to use, if not using a labelKey. When none is defined, no label is shown.
- uploadButtonKey = key in messages.properties for the upload button unescaped text (can have html for icons).
- uploadButton = upload button text to use, if not using a uploadButtonKey. Defaults to "Upload"
- deleteConfirmKey = key in messages.properties for the delete image confirmation modal.
- deleteConfirm = delete image confirmation text, if not using a deleteConfirmKey. 
				  If neither deleteConfirmKey nor deleteConfirm is given, no confirmation on delete is asked.

Example:
<div th:replace="~{/yadacms/imageSorter::component(images=${product.galleryImages},entityIdValue=${product.id},urlAdd=@{/cms/ajaxAddGalleryImage},urlDelete=@{/cms/product/deleteGalleryImage},urlSort=@{/cms/product/ajaxSortGalleryImage},labelKeyAdd='form.label.product.addGallery',deleteConfirmKey='confirm.imageGallery.delete')}"></div>


*/-->
<body>
<th:block th:fragment="component">
	<div th:if="${entityIdValue!=null}" class="yadaImageSorter" th:with="sorterId=${sorterId}?:'yadaImageSorter',entityIdName=${entityIdName}?:'id'" th:id="${sorterId}">
    	<form th:action="${urlAdd}" data-yadaUpdateOnSuccess="yadaSiblings:.yadaImageSorterImages" 
    		enctype="multipart/form-data" class="yadaAjax" method="post" role="form">
			<fieldset>
				<input type="hidden" th:name="${entityIdName}" th:value="${entityIdValue}">
				<div class="form-group">
					<label th:if="${labelAdd!=null || labelKeyAdd!=null}" th:for="|${sorterId}-newImage|" th:utext="${labelKeyAdd!=null?#messages.msg(labelKeyAdd):labelAdd}">Upload gallery image</label>
					<div th:if="${size!=null}" class="yadaMinimumSize"><span th:text="${size}">100x100</span> [[#{yada.form.fileUpload.minimumSize}]]</div>
					<input type="file" th:id="|${sorterId}-newImage|" th:name="${multipartName}?:newImage" th:accept="${accept}?:''" th:required="${required}">
				</div>
				<button class="btn btn-success" type="submit" name="Upload" th:utext="${uploadButtonKey!=null?#messages.msg(uploadButtonKey):uploadButton?:'Upload'}">Upload</button>
			</fieldset>
		</form>

		<form th:action="${urlSort}" data-yadaUpdateOnSuccess="yadaSiblings:.yadaImageSorterImages" class="yadaAjax sortForm">
			<input type="hidden" th:name="${entityIdName}" th:value="${entityIdValue}">
		</form>
		<form th:action="${urlDelete}" data-yadaUpdateOnSuccess="yadaSiblings:.yadaImageSorterImages" class="yadaAjax deleteForm"
			yada:confirm="${deleteConfirmKey!=null?#messages.msg(deleteConfirmKey):deleteConfirm?:''}">
			<input type="hidden" th:name="${entityIdName}" th:value="${entityIdValue}">
		</form>
		
		
		<div class="yadaImageSorterImages">
			<div th:each="galleryImage,iter : ${images}" class="yadaImageControl">
				<img th:src="@{${@yadaFileManager.getMobileImageUrl(galleryImage)}}" />
				<div class="commandBar">
					<!--/* Move up */-->
					<form th:unless="${iter.last}" th:action="${urlSort}" data-yadaParentForm="yadaClosestFind:.yadaImageSorter .sortForm" >
						<input type="hidden" name="currentId" th:value="${galleryImage.id}">
						<input type="hidden" name="otherId" th:value="${images.get(iter.index+1).id}">
						<a href="#" onclick="$(this).closest('form').submit(); return false;">
							<i class="moveup fa fa-chevron-down" aria-hidden="true"></i>
						</a>
					</form>
					<!--/* Move down */-->
					<form th:unless="${iter.first}" data-yadaParentForm="yadaClosestFind:.yadaImageSorter .sortForm" >
						<input type="hidden" name="currentId" th:value="${galleryImage.id}">
						<input type="hidden" name="otherId" th:value="${images.get(iter.index-1).id}">
						<a href="#" onclick="$(this).closest('form').submit(); return false;">
							<i class="moveup fa fa-chevron-up" aria-hidden="true"></i>
						</a>
					</form>
					<!--/* Delete */-->
					<form th:action="${urlDelete}" data-yadaParentForm="yadaClosestFind:.yadaImageSorter .deleteForm" >
						<input type="hidden" name="imageId" th:value="${galleryImage.id}">
						<a href="#" onclick="$(this).closest('form').submit(); return false;">
							<i class="delete fa fa-trash-o" aria-hidden="true"></i>
						</a>
					</form>
				</div>
			</div>
		</div>
	</div>

</th:block>    	
</body>
</html>

